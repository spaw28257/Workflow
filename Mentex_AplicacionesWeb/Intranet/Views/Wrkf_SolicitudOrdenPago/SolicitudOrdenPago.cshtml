<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MENTEX C.A.</title>
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

    <!-- Font Awesome -->
    <link href="~/Adminlte/plugins/fontawesome-free/css/all.min.css" rel="stylesheet" />

    <!-- DataTables -->
    <link href="~/Adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css" rel="stylesheet" />

    <!-- Theme style -->
    <link href="~/Adminlte/css/adminlte.min.css" rel="stylesheet" />
    <!-- overlayScrollbars -->
    <link href="~/Adminlte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css" rel="stylesheet" />
    <!-- summernote -->
    <link href="~/Adminlte/plugins/summernote/summernote-bs4.min.css" rel="stylesheet" />

    <link href="~/Adminlte/css/mentex.css" rel="stylesheet" />

</head>
<body class="hold-transition sidebar-mini layout-fixed" onload="LoadPrincipal();">

    <div class="wrapper">
        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img src="~/Adminlte/img/Iphone-spinner-2.gif" class="animation__shake brand-image img-rounded elevation-3" alt="Mentex C.A." height="40" width="40" />
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="@Url.Action("Index", "Home")" class="nav-link"><i class="fas fa-home"></i>&nbsp;Inicio</a>
                </li>
                <li><i class="fas fa-money"></i></li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" onclick="LoadPrincipal()" class="nav-link"><i class="fas fa-newspaper"></i>&nbsp;Crear Solicitud</a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="@Url.Action("CerrarSesion", "Wrkf_Login")" class="nav-link"><i class="fas fa-lock"></i>&nbsp;Cerrar Sesión</a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-light elevation-4">
            <!-- Brand Logo -->
            <a href="#" class="brand-link">
                <img src="~/Adminlte/img/LogoWorkflow.png" alt="Mentex C.A." class="brand-image img-rounded elevation-3" style="opacity: .8" />
                <span class="brand-text font-weight-light">MENTEX C.A.</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="~/Adminlte/img/user_undefine160x160.png" class="img-circle elevation-2" alt="User Image" />
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">@Session["sUsuario_Id"]</a>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false" id="ulOpcionesMenu">

                        @foreach (var listadomenu in ViewBag.listaropcionesmenu)
                        {
                            <li class="nav - item">
                                <p>
                                    <a href="@Url.Action(@listadomenu.Accionx, @listadomenu.Controladorx)"><i class="@listadomenu.Imagenx"></i>&nbsp;@listadomenu.Menux</a>
                                </p>
                            </li>
                        }
                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <div class="row">
                <div class="col-md-12">
                    &nbsp;
                </div>
            </div>
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card card-primary">
                                <div class="card-header" style="background-color: #82293E;">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h3 class="card-title" id="numordpago">Solicitud de Orden de Pago Manual</h3>
                                        </div>
                                    </div>
                                </div>
                                <!-- /.card-header -->
                                <!-- form start -->
                                <form enctype="multipart/form-data">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <input type="hidden" name="txtcodigoSolicitud"
                                                       id="txtcodigoSolicitud" value=""
                                                       style="background-color: oldlace;" readonly class="form-control" />
                                            </div>
                                        </div>
                                        <h4><u>Datos de la Plantilla</u></h4>
                                        <!--Datos del Plantilla---------------------------------------------------------------------------------------->
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtCodigoPlantilla">
                                                        <a href="#" data-toggle="modal"
                                                           data-target="#modal-plantillas" style="cursor:pointer; color:blue;" onclick="ListarPlantillasPagoNofrecuente()">
                                                            Código Plantilla &nbsp; <i class="fas fa-search"></i>
                                                        </a>
                                                    </label>
                                                    <input type="text" id="txtCodigoPlantilla" name="txtCodigoPlantilla"
                                                           class="form-control" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtNombrePlantilla">Nombre Plantilla</label>
                                                    <input type="text" id="txtNombrePlantilla" name="txtNombrePlantilla" class="form-control"
                                                           style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="cbogruporubrodesc">
                                                        <a href="#" data-toggle="modal" data-target="#modal-lg3" style="cursor:pointer; color:blue;">
                                                            <u style="cursor:pointer" title="Despliega una lista con los grupos de rubro">Grupo del Rubro</u>
                                                            &nbsp; <i class="fas fa-search" onclick="GetGrupoRubros_All()"></i>
                                                        </a>
                                                    </label>
                                                    <input type="text" name="cbogruporubrodesc" id="cbogruporubrodesc" value="" class="form-control"
                                                           readonly style="cursor: pointer; background-color: oldlace;" data-toggle="modal" data-target="#modal-lg3" />
                                                    <input type="hidden" name="cbogruporubro" id="cbogruporubro" value="" class="form-control" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="cborubrodesc">
                                                        <a href="#" data-toggle="modal" data-target="#modal-lg4" style="cursor:pointer; color:blue;">
                                                            <u style="cursor:pointer" title="Despliega una lista con los rubros">Rubro</u>
                                                            &nbsp; <i class="fas fa-search" onclick="GetRubros_All()"></i>
                                                        </a>
                                                    </label>
                                                    <input type="text" name="cborubrodesc" id="cborubrodesc" value="" class="form-control"
                                                           readonly style="cursor: pointer; background-color: oldlace;" data-toggle="modal" data-target="#modal-lg4" />
                                                    <input type="hidden" name="cborubro" id="cborubro" value="" class="form-control" />
                                                </div>
                                            </div>
                                        </div>
                                        <!------------------------------------------------------------------------------------------------------------->
                                        <!--Datos del Proveedor---------------------------------------------------------------------------------------->
                                        <h4><u>Datos del Proveedor</u></h4>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtProveedorId">
                                                        <a href="#" data-toggle="modal" data-target="#modal-lg" style="cursor:pointer; color:blue;" onclick="GetListadoProveedoresPorClaseId()">
                                                            <u style="cursor:pointer" title="Despliega una lista con los proveedores">Proveedor Id</u>
                                                            &nbsp; <i class="fas fa-search"></i>
                                                        </a>
                                                    </label>
                                                    <input type="text" class="form-control" id="txtProveedorId" name="txtProveedorId" style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtrif">
                                                        R.I.F
                                                    </label>
                                                    <input type="text" class="form-control" id="txtrif" style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtproveedor">
                                                        Proveedor
                                                    </label>
                                                    <input type="text" class="form-control" id="txtproveedor" name="txtproveedor" style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    <label for="txtTaxScheduleID">
                                                        <a href="#" data-toggle="modal" data-target="#modal-plan-impuesto-iva" style="cursor:pointer; color:blue;"
                                                           onclick="ListarDetalleImpuestoIVACompra()">
                                                            Plan de Impuesto
                                                            &nbsp; <i class="fas fa-search"></i>
                                                        </a>
                                                    </label>
                                                    <input type="text" class="form-control" id="txtTaxScheduleID" name="txtTaxScheduleID" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                        </div>
                                        <!------------------------------------------------------------------------------------------------------------->
                                        <!--Datos del documento---------------------------------------------------------------------------------------->
                                        <h4><u>Datos del Documento</u></h4>
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="cboTipoDocumento">Tipo</label>
                                                    <select name="cboTipoDocumento" id="cboTipoDocumento" class="form-control" style="background-color: oldlace;">
                                                        <option value="">--Seleccione Tipo de Documento--</option>
                                                        @foreach (var listatipodocumento in ViewBag.listatipodocumento)
                                                        {
                                                            <option value="@listatipodocumento.Tipodocumento_Id">@listatipodocumento.Documento</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="cboTipoDocumento">Concepto</label>
                                                    <select name="cboConcepto" id="cboConcepto" class="form-control" style="background-color: oldlace;">
                                                        <option value="">--Seleccione Concepto--</option>
                                                        @foreach (var listaconcepto in ViewBag.listaconceptos)
                                                        {
                                                            <option value="@listaconcepto.Codigo">@listaconcepto.Descripcion</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="cbomoneda">Moneda</label>
                                                    <input type="text" class="form-control" id="cbomoneda" name="cbomoneda" style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="txtdescripcion">Descripción</label>
                                                    <input type="text" class="form-control" id="txtdescripcion" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtnumerodocumento"> N° Documento </label>
                                                    <input type="text" class="form-control" id="txtnumerodocumento" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtnumcontrol"> N° Control </label>
                                                    <input type="text" class="form-control" id="txtnumcontrol" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtfechacreacion">Fecha Doc.</label>
                                                    <input type="date" class="form-control" id="txtfecdocumento" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtfechacreacion">Fecha Pago</label>
                                                    <input type="date" class="form-control" id="txtfecpago" style="background-color: oldlace;" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="cboformapago">Forma de Pago</label>
                                                    <select name="cboformapago" id="cboformapago" style="background-color: oldlace;" class="form-control">
                                                        <option value="0">--Seleccionar--</option>
                                                        @foreach (var listaformapago in ViewBag.listaformapago)
                                                        {
                                                            <option value="@listaformapago.Formapago_Id">@listaformapago.Formadepago</option>
                                                        }
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtmontodocumento">Monto Excento</label>
                                                    <input type="text" class="form-control" id="txtmontodocumento" style="text-align: right; font-weight: bold;
                                                        background-color: oldlace;" value="0,00" />
                                                </div>
                                            </div>
                                        </div>
                                        <!------------------------------------------------------------------------------------------------------------->

                                        <div class="row">
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtBaseIvaGE">Base Imponible IVA General</label>
                                                    <input type="text" class="form-control" id="txtBaseIvaGE" style="text-align: right; font-weight: bold; background-color: oldlace;" value="0,00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtBaseIvaRe">Base Imponible IVA Reducido</label>
                                                    <input type="text" class="form-control" id="txtBaseIvaRe" style="text-align: right; font-weight: bold; background-color: oldlace;" value="0,00">
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group">
                                                    <label for="txtBaseIvaAd">Base Imponible IVA Adicional</label>
                                                    <input type="text" class="form-control" id="txtBaseIvaAd" style="text-align: right; font-weight: bold; background-color: oldlace;" value="0,00">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label for="txttotal">Total a Pagar</label>
                                                    <input type="text" class="form-control" id="txttotal" style="text-align: right; font-weight: bold; background-color: oldlace;" readonly="readonly" value="0,00">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group">
                                                    <label for="fileAdjuntarArchivo">Adjuntar Soportes de Pago</label>
                                                    <input id="fileAdjuntarArchivo" name="fileAdjuntarArchivo" type="file" multiple class="form-control" style="background-color: oldlace;">
                                                </div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="form-group">
                                                    <label for="txtobservaciones">Observaciones</label>
                                                    <textarea name="txtobservaciones" id="txtobservaciones" class="form-control" rows="1" cols="80" style="background-color: oldlace;"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->

                                        <div class="card-footer">
                                            <div class="container-fluid">
                                                <div class="row">
                                                    <div class="col-md-4">
                                                        <button type="button" name="btnBuscarOrdenPago" id="btnBuscarOrdenPago"
                                                                class="btn btn-default" data-toggle="modal" data-target="#modal-lg1" onclick="GetSolicitudOrdenPagoTodas()"
                                                                style="width: 100%; font-weight: bold; font-family: sans-serif;">
                                                            <i class="fas fa-search"></i>&nbsp;Buscar
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="button" name="btnVerSoportes" id="btnVerSoportes"
                                                                class="btn btn-default" onclick="Descargarsoporte('@Url.Action("DescargarSoporte", "Wrk_SolicitudOrdenPagoSoporte")')"
                                                                style="width: 100%; font-weight: bold; font-family: sans-serif;">
                                                            <i class="fas fa-file-archive"></i>&nbsp;Soportes
                                                        </button>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <button type="button" name="btnagregar" id="btnagregar"
                                                                class="btn btn-default" style="width: 100%; font-weight: bold; font-family: sans-serif;">
                                                            <i class="fas fa-save"></i>&nbsp;Guardar
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">

                        </div>
                    </div>
                </div>
                <!--Lista los proveedores por el rubro seleccionado-->
                <div class="modal fade" id="modal-lg">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Listado de Proveedores</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table class="table table-head-fixed text-nowrap table-bordered" id="table-proveedores">
                                    <thead>
                                        <tr>
                                            <th>Proveedor ID</th>
                                            <th>Proveedor</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr style="background-color:beige;">
                                            <th colspan="2" style="text-align: left; font-weight:bold; font-size:12px; font-family:'Arial';">&nbsp;</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!--Listado de plantillas-->
                <div class="modal fade" id="modal-plantillas">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Listado de Plantillas</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="table-plantillas" class="table table-bordered table-hover" style="width:100%;">
                                    <thead>
                                        <tr class="cabecera-tabla">
                                            <th style="text-align:center; font-weight:bold;">Código</th>
                                            <th style="text-align:center; font-weight:bold;">Nombre</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr style="background-color:beige;">
                                            <th colspan="2" style="text-align: left; font-weight:bold; font-size:12px; font-family:'Arial';">&nbsp;</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!------------------------->
                <!--Listado de plan de impuestos compra IVA-->
                <div class="modal fade" id="modal-plan-impuesto-iva">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Listado de Plan de Impuesto</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table id="table-plan-impuesto-iva" class="table table-bordered table-hover" style="width:100%;">
                                    <thead>
                                        <tr class="cabecera-tabla">
                                            <th style="text-align:center; font-weight:bold;">Código</th>
                                            <th style="text-align:center; font-weight:bold;">Nombre</th>
                                            <th style="text-align:center; font-weight:bold;">Porcentaje Retención</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr style="background-color:beige;">
                                            <th colspan="3" style="text-align: left; font-weight:bold; font-size:12px; font-family:'Arial';">&nbsp;</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!------------------------->

                <div class="modal fade" id="modal-lg1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Solicitudes de Ordenes de Pagos</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table class="table table-bordered table-hover" style="width:100%;" id="table-solicitudes-pago">
                                    <thead>
                                        <tr>
                                            <th class="text-center">Acciones</th>
                                            <th class="text-center">N° Pago</th>
                                            <th class="text-center">Código Plantilla</th>
                                            <th class="text-center">Id Proveedor</th>
                                            <th class="text-center">Proveedor</th>
                                            <th class="text-center">Factura</th>
                                            <th class="text-center">Monto</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>

                <!-- /.modal -->
                <!--Lista de los grupos de rubros-->
                <div class="modal fade" id="modal-lg3">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Grupo de Rubros</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table class="table table-bordered table-hover" style="width:100%;" id="table-gruporubro">
                                    <thead>
                                        <tr>
                                            <th>Grupo Rubro Id</th>
                                            <th>Grupo Rubro</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr style="background-color:beige;">
                                            <th colspan="2" style="text-align: left; font-weight:bold; font-size:12px; font-family:'Arial';">&nbsp;</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!--Lista de los rubros registrados-->
                <div class="modal fade" id="modal-lg4">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Rubros</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table class="table table-bordered table-hover" style="width:100%;" id="table-rubro">
                                    <thead>
                                        <tr>
                                            <th>Rubro Id</th>
                                            <th>Rubros</th>
                                        </tr>
                                    </thead>
                                    <tfoot>
                                        <tr style="background-color:beige;">
                                            <th colspan="2" style="text-align: left; font-weight:bold; font-size:12px; font-family:'Arial';">&nbsp;</th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!--Listar soportes de pagos-->
                <div class="modal fade" id="modal-lg5">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title">Soportes de Pagos</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <table class="table table-head-fixed text-nowrap table-bordered" style="width:100%;">
                                    <thead>
                                        <tr>
                                            <th>Soportes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="DetalleSoporte"></tbody>
                                </table>
                            </div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!--Mensajes de Error-->
                <div class="modal fade" id="modal-lista-errores">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header color-mentex">
                                <h4 class="modal-title" id="TituloMensaje">Mensaje de Errores</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="divMensajesError"></div>
                            <div class="modal-footer justify-content-between">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /.modal -->
                <!------------------------->

            </section>
            <!-- Main content -->
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->
        <footer class="main-footer">
            @*<strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>All rights reserved.*@
            <div class="float-right d-none d-sm-inline-block">
                <b>WorkFlow Cuentas Por Pagar Version</b> 1.0
            </div>
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div> <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="~/Adminlte/plugins/jquery/jquery.min.js"></script>
    <!-- jQuery UI 1.11.4 -->
    <script src="~/Adminlte/plugins/jquery-ui/jquery-ui.min.js"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button)
    </script>
    <!-- Bootstrap 4 -->
    <script src="~/Adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Sparkline -->
    <script src="~/Adminlte/plugins/sparklines/sparkline.js"></script>
    <!-- jQuery Knob Chart -->
    <script src="~/Adminlte/plugins/jquery-knob/jquery.knob.min.js"></script>
    <!-- Summernote -->
    <script src="~/Adminlte/plugins/summernote/summernote-bs4.min.js"></script>
    <!-- overlayScrollbars -->
    <script src="~/Adminlte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>
    <!-- AdminLTE App -->
    <script src="~/Adminlte/js/adminlte.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/Adminlte/js/demo.js"></script>

    <!-- DataTables  & Plugins -->
    <script src="~/Adminlte/plugins/datatables/jquery.dataTables.js"></script>
    <script src="~/Adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>

    <script src="~/Adminlte/plugins/sweetalert2/sweetalert.min.js"></script>
    <script src="~/Adminlte/plugins/maskMoney/jquery.maskMoney.min.js"></script>
    <script src="~/Scripts/UtilidadesVarias.js"></script>
    <script src="~/Scripts/SolicitudOrdenPago.js"></script>
    <script>
        $("#btnagregar").click(function () {
            AddItemSolicitudPago();
        });

        $("#btncalcular").click(function () {
            GetCalcularMontos();
        });

        //funcion para ejecutar al momento de la carga del formulario
        function LoadPrincipal() {
                //obtiene fecha actual
             $.ajax({
                type: 'POST',
                url: '@Url.Action("GetFechaActual", "Wrkf_SolicitudOrdenPago")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data) {
                    var fecha_actual = [];
                    fecha_actual = data;
                    var total_fecha_actual = fecha_actual.length;

                    if (fecha_actual[0].Codigox == "") {
                        if (total_fecha_actual > 0) {
                            document.getElementById("txtfecdocumento").value = fecha_actual[0].Fecha_actual;
                            document.getElementById("txtfecpago").value = fecha_actual[0].Fecha_actual;

                            //inicializar componentes
                            BorrarCampos();

                        }
                    } else {
                        swal(fecha_actual[0].Codigox + " " + fecha_actual[0].Mensajex, fecha_actual[0].Titulox, fecha_actual[0].Tipox);
                    }
                },
                 error: function (jqXHR, exception) {
                     var msg = '';
                     if (jqXHR.status === 0) {
                         msg = 'Not connect.\n Verify Network.';
                         swal(msg, 'Error', 'error');
                     } else if (jqXHR.status == 404) {
                         msg = 'Requested page not found. [404]';
                         swal(msg, 'Error', 'error');
                     } else if (jqXHR.status == 500) {
                         msg = 'Internal Server Error [500].';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'parsererror') {
                         msg = 'Requested JSON parse failed.';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'timeout') {
                         msg = 'Time out error.';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'abort') {
                         msg = 'Ajax request aborted.';
                         swal(msg, 'Error', 'error');
                     } else {
                         msg = 'Uncaught Error.\n' + jqXHR.responseText;
                         swal(msg, 'Error', 'error');
                     }
                 }
             });

            //cargar las monedas de operación
            GetMoneda(0);
        }

        //Borrar los campos del formulario
        function BorrarCampos() {
            $("#txtCodigoPlantilla").val("");
            $("#txtNombrePlantilla").val("");
            $("#cbogruporubrodesc").val("");
            $("#cbogruporubro").val("");
            $("#cborubrodesc").val("");
            $("#cborubro").val("");
            $("#txtProveedorId").val("");
            $("#txtrif").val("");
            $("#txtproveedor").val("");
            $("#txtTaxScheduleID").val("");
            $("#cboTipoDocumento").val("");
            $("#cboConcepto").val("");
            $("#cbomoneda").val("");
            $("#txtdescripcion").val("");
            $("#txtnumerodocumento").val("");
            $("#txtnumcontrol").val("");
            $("#cboformapago").val("0");
            $("#txtmontodocumento").val("0,00");
            $("#txtBaseIvaGE").val("0,00");
            $("#txtBaseIvaRe").val("0,00");
            $("#txtBaseIvaAd").val("0,00");
            $("#txttotal").val("0,00");
            var fileInput = document.getElementById('fileAdjuntarArchivo');
            fileInput.value = "";
            $("#txtobservaciones").val("");
        }

        //function para listar todas las solicitudes de las ordenes de pago
        function GetSolicitudOrdenPagoTodas() {
            var total_elemento = 0;
            var parametros = {};

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetSolicitudOrdenPagoTodas", "Wrkf_SolicitudOrdenPago")',
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    total_elemento = data.ListadoSolicitudPago.length;
                    if (data.ListadoSolicitudPago[0].Codigox == "") {
                        if (total_elemento > 0) {

                            $("#table-solicitudes-pago").DataTable({
                                "destroy": true,
                                "paging": true,
                                "lengthChange": true,
                                "searching": true,
                                "ordering": true,
                                "info": true,
                                "autoWidth": true,
                                "responsive": true,
                                data: data.ListadoSolicitudPago,
                                columns: [
                                    {
                                        "data": "Codigo", "render": function (data) {
                                            var pCodigo = "'" + data + "'";
                                            var strHtml = '<div class="text-center">';
                                            strHtml += '<a href="#" onclick="AnularSolicitudOrdenPago(' + pCodigo + ')" ';
                                            strHtml += 'style = "color:black;" > <i class="fas fa-eraser" title="Anular la Solicitud de Pago"></i></a > ';
                                            strHtml += '</div>';
                                            return strHtml;
                                        }
                                    },
                                    {
                                        "data": "Codigo", "render": function (data) {
                                            var pCodigo = "'" + data + "'";
                                            return '<a href="#" onclick="GetDetalleOrden(' + pCodigo + ')" data-dismiss="modal" title="Ver el detalle del pago">' + data + '</a>';
                                        }
                                    },
                                    {
                                        "data": "GAPCodigoPlantilla"
                                    },
                                    {
                                        "data": "GAPIdProveedor"
                                    },
                                    {
                                        "data": "GAPProveedor"
                                    },
                                    {
                                        "data": "GAPNroFactura"
                                    },
                                    {
                                        "data": "GAPMonto", "render": function (data) {
                                            return number_format(parseFloat(data), 2, ',', '.');
                                        }
                                    }
                                ]
                            });
                        }
                    }
                    else {
                        swal(data.ListadoSolicitudPago[0].Codigox + " " + data.ListadoSolicitudPago[0].Mensajex, data.ListadoSolicitudPago[0].Titulox, data.ListadoSolicitudPago[0].Tipox);
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //obtiene el detalle de la solicitud de orden de pago
        function GetDetalleOrden(pcodigo) {

            var parametros = { "pCodigo": pcodigo };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetDetalleOrdenPagoPorRevisarCxP", "Wrkf_SolicitudOrdenPagoCxP")',
                dataType: 'json',
                data: parametros,
                success: function (data) {

                    //Especificar el detalle del pago
                    $("#txtcodigoSolicitud").val(data.DetallePago.Codigo);
                    $("#txtCodigoPlantilla").val(data.DetallePago.GAPCodigoPlantilla);
                    $("#txtNombrePlantilla").val(data.DetallePago.GAPDescripcionPlantilla);
                    $("#cbogruporubro").val(data.DetallePago.GrupoRubro_Id);
                    $("#cbogruporubrodesc").val(data.DetallePago.GrupoRubroDescripcion);
                    $("#cborubro").val(data.DetallePago.Rubro_Id);
                    $("#cborubrodesc").val(data.DetallePago.RubroDescripcion);

                    $("#txtProveedorId").val(data.DetallePago.GAPIdProveedor);
                    $("#txtrif").val(data.DetallePago.GAPRIF);
                    $("#txtproveedor").val(data.DetallePago.GAPProveedor);
                    $("#txtTaxScheduleID").val(data.DetallePago.PlanImpuesto);

                    $("#cboTipoDocumento").val(data.DetallePago.Tipodocumento);
                    $("#cboConcepto").val(data.DetallePago.GAPCodigoConcepto);
                    $("#cbomoneda").val(data.DetallePago.CodigoMoneda);
                    $("#txtdescripcion").val(data.DetallePago.GAPDescripcionFactura);

                    $("#txtnumerodocumento").val(data.DetallePago.GAPNroFactura);
                    $("#txtnumcontrol").val(data.DetallePago.GAPNroControl);
                    document.getElementById("txtfecdocumento").value = ConvertirFechaEnYyyymmdd(data.DetallePago.GAPFechaFactura);
                    document.getElementById("txtfecpago").value = ConvertirFechaEnYyyymmdd(data.DetallePago.GAPFechaPago);
                    $("#cboformapago").val(data.DetallePago.TipoPago);
                    $("#txtmontodocumento").val(number_format(parseFloat(data.DetallePago.GAPMontoExento), 2, ',', '.'));
                    $("#txtBaseIvaGE").val(number_format(parseFloat(data.DetallePago.GAPBaseImpIVAGeneral), 2, ',', '.'));
                    $("#txtBaseIvaRe").val(number_format(parseFloat(data.DetallePago.GAPBaseImpIVAReducido), 2, ',', '.'));
                    $("#txtBaseIvaAd").val(number_format(parseFloat(data.DetallePago.GAPBaseImpIVAAdicional), 2, ',', '.'));
                    $("#txttotal").val(number_format(parseFloat(data.DetallePago.GAPMonto), 2, ',', '.'));
                    $("#txtobservaciones").val(data.DetallePago.Observaciones);
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
            return;

        }

        function GetCalcularMontos() {

            //el precio unitario sean especificados
            if ($("#txtmontodocumento").val() !== "") {

                var vMontoDocumento = $("#txtmontodocumento").val().replaceAll(".", "");
                var vBaseIvaGE = $("#txtBaseIvaGE").val().replaceAll(".", "");
                var vBaseIvaRe = $("#txtBaseIvaRe").val().replaceAll(".", "");
                var vBaseIvaAd = $("#txtBaseIvaAd").val().replaceAll(".", "");

                var vPlanImpuesto = $("#txtTaxScheduleID").val().trim();

                var parametros = {
                    "pMontoDocumento": vMontoDocumento,
                    "pBaseIvaGe": vBaseIvaGE,
                    "pBaseIvaRe": vBaseIvaRe,
                    "pBaseIvaAd": vBaseIvaAd,
                    "pPlanImpuesto": vPlanImpuesto
                };

                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("GetCalcularMontos", "Wrkf_SolicitudOrdenPago")',
                    dataType: 'json',
                    data: parametros,
                    success: function (data) {
                        var vTotalPagar = number_format(parseFloat(data[0].Totalapagar), 2, ',', '.');
                        $("#txttotal").val(vTotalPagar);
                    },
                    error: function (jqXHR, exception) {
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg = 'Not connect.\n Verify Network.';
                            swal(msg, 'Error', 'error');
                        } else if (jqXHR.status == 404) {
                            msg = 'Requested page not found. [404]';
                            swal(msg, 'Error', 'error');
                        } else if (jqXHR.status == 500) {
                            msg = 'Internal Server Error [500].';
                            swal(msg, 'Error', 'error');
                        } else if (exception === 'parsererror') {
                            msg = 'Requested JSON parse failed.';
                            swal(msg, 'Error', 'error');
                        } else if (exception === 'timeout') {
                            msg = 'Time out error.';
                            swal(msg, 'Error', 'error');
                        } else if (exception === 'abort') {
                            msg = 'Ajax request aborted.';
                            swal(msg, 'Error', 'error');
                        } else {
                            msg = 'Uncaught Error.\n' + jqXHR.responseText;
                            swal(msg, 'Error', 'error');
                        }
                    }
                });
            }
            else {
                swal("El monto del documento es requerido", "Error", "error");
            }
        }

        //La función muestra un listado de los proveedores por clase ID
        function GetListadoProveedoresPorClaseId() {

            var total_elemento = 0;
            var parametros = {};

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ListadoProveedores_todos", "Wrkf_Proveedor")',
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    total_elemento = data.ListadoProveedores.length;
                    if (data.ListadoProveedores[0].Codigox == "") {
                        if (total_elemento > 0) {

                            $("#table-proveedores").DataTable({
                                "destroy": true,
                                "paging": true,
                                "lengthChange": true,
                                "searching": true,
                                "ordering": true,
                                "info": true,
                                "autoWidth": true,
                                "responsive": true,
                                data: data.ListadoProveedores,
                                columns: [
                                    {
                                        "data": "Vendorid", "render": function (data) {
                                            var pVendorid = "'" + data + "'";
                                            return '<a href="#" onclick="SeleccionarProveedorId(' + pVendorid + ')" data-dismiss="modal">' + data + '</a>';
                                        }
                                    },
                                    {
                                        "data": "Vendname"
                                    }
                                ]
                            });
                        }
                    }
                    else {
                        swal(data.ListadoProveedores[0].Codigox + " " + data.ListadoProveedores[0].Mensajex, data.ListadoProveedores[0].Titulox, data.ListadoProveedores[0].Tipox);
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });

        }

        //Selecciona los datos del proveedor por IDProveedor
        function SeleccionarProveedorId(pIdproveedor) {

            var total_elemento = 0;
            var parametros = { "pVendorid": pIdproveedor};

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetListadoProveedorPorId", "Wrkf_Proveedor")',
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    total_elemento = data.ListadoProveedores.length;

                    if (data.ListadoProveedores[0].Codigox == "") {

                        if (total_elemento > 0) {
                            $("#txtProveedorId").val(data.ListadoProveedores[0].Vendorid);
                            $("#txtrif").val(data.ListadoProveedores[0].Txrgnnum);
                            $("#txtproveedor").val(data.ListadoProveedores[0].Vendname);
                            $("#txtTaxScheduleID").val(data.ListadoProveedores[0].Vtaxschid);
                        }
                    }
                    else {
                        swal(data.ListadoProveedores[0].Codigox + " " + data.ListadoProveedores[0].Mensajex, data.ListadoProveedores[0].Titulox, data.ListadoProveedores[0].Tipox);
                    }

                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //subir los soportes de pago
        function SubirSoportesPagos(pCodigo, pCodigoItem, pFechaPago) {
            var formData = new FormData();
            var fileInput = document.getElementById('fileAdjuntarArchivo');
            for (i = 0; i < fileInput.files.length; i++) {
                formData.append(fileInput.files[i].name, fileInput.files[i]);
            }

            formData.append("CodigoPlantilla", $("#txtCodigoPlantilla").val());
            formData.append("CodigoPago", pCodigo);
            formData.append("CodigoItemPago", pCodigoItem);
            formData.append("FechaPagoItem", pFechaPago);

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Action("UploadSoportesPago", "Wrkf_SolicitudOrdenPago")');
            xhr.send(formData);
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                }
            }
        }

        /*Listar las plantillas de pagos no frecuentes*/
        function ListarPlantillasPagoNofrecuente() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("ListarPlantillasPagoNofrecuente", "Wrkf_Plantilla")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data) {

                    if (data.Plantillas[0].Codigox.length > 0) {
                        swal(data.Plantillas[0].Codigox + ' ' + data.Plantillas[0].Mensajex, data.Plantillas[0].Titulox, data.Plantillas[0].Tipox);
                    } else {
                        $("#table-plantillas").DataTable({
                            "destroy": true,
                            "paging": true,
                            "lengthChange": true,
                            "searching": true,
                            "ordering": true,
                            "info": true,
                            "autoWidth": true,
                            "responsive": true,
                            data: data.Plantillas,
                            columns: [
                                {
                                    "data": "Codigo", "render": function (data) {
                                        var pCodigoPlantilla = "'" + data + "'";
                                        return '<a href="#" onclick="SeleccionarPlantilla(' + pCodigoPlantilla + ')" data-dismiss="modal">' + data + '</a>';
                                    }
                                },
                                {
                                    "data": "Nombre"
                                }
                            ]
                        });
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //Selecciona el codigo y el nombre de la plantilla
        function SeleccionarPlantilla(pCodigoPlantilla) {
            var parametros = {
                "codigo": pCodigoPlantilla
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("SeleccionarPlantillaPorCodigo", "Wrkf_Plantilla")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    if (data.Codigox.length > 0) {
                        swal(data.Codigox + ' ' + data.Mensajex, data.Titulox, data.Tipox);
                    } else {
                        $("#txtCodigoPlantilla").val(data.Codigo);
                        $("#txtNombrePlantilla").val(data.Nombre);

                        //seleccionar el código de la moneda
                        SeleccionarCodigoMoneda(data.IdChequera);
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }
        /**************************************************/

        //Obtiene el código de la moneda segun el codigo de la plantilla y el código de la chequera
        function SeleccionarCodigoMoneda(pChequeraId) {
            var parametros = {
                "pchequera_id": pChequeraId
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetChequera_Key", "Wrkf_Chequera")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    if (data.chequera.Codigox.length > 0) {
                        swal(data.chequera.Codigox + ' ' + data.chequera.Mensajex, data.chequera.Titulox, data.chequera.Tipox);
                    } else {
                        $("#cbomoneda").val(data.chequera.Codigomonedax);
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //lista los rubros segun el departamento o grupo de rubros
        function GetRubros_All() {

            var parametros = {
                "pGrupoRubro_Id": $("#cbogruporubro").val()
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetRubros_All", "Wrkf_Rubro")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {

                    if (data.ListadoRubro[0].Codigox.length > 0) {
                        swal(data.ListadoRubro[0].Codigox + ' ' + data.ListadoRubro[0].Mensajex, data.ListadoRubro[0].Titulox, data.ListadoRubro[0].Tipox);
                    } else {
                        $("#table-rubro").DataTable({
                            "destroy": true,
                            "paging": true,
                            "lengthChange": true,
                            "searching": true,
                            "ordering": true,
                            "info": true,
                            "autoWidth": true,
                            "responsive": true,
                            data: data.ListadoRubro,
                            columns: [
                                {
                                    "data": "Rubro_Id", "render": function (data) {
                                        var pRubro_Id = "'" + data + "'";
                                        return '<a href="#" onclick="GetRubroPorId(' + pRubro_Id + ')" data-dismiss="modal">' + data + '</a>';
                                    }
                                },
                                {
                                    "data": "Descripcion"
                                }
                            ]
                        });
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //selecciona los datos del rubro por Rubro_Id y Departamento_Id
        function GetRubroPorId(pRubro_Id) {
            var parametros = { "pGrupoRubro_Id": $("#cbogruporubro").val(), "pRubro_Id": pRubro_Id,  };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetRubros_Key", "Wrkf_Rubro")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    $("#cborubrodesc").val(data.DatosRubro.Descripcion);
                    $("#cborubro").val(data.DatosRubro.Rubro_Id);
                },
                error: function (ex) {
                    var r = jQuery.parseJSON(response.responseText);
                    alert("Message: " + r.Message);
                    alert("StackTrace: " + r.StackTrace);
                    alert("ExceptionType: " + r.ExceptionType);
                }
            });
        }

        //Funcion para listar los grupos de rubros
        function GetGrupoRubros_All() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetGrupoRubros_All", "Wrkf_GrupoRubro")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data) {

                    if (data.ListadoGrupoRubro[0].Codigox.length > 0) {
                        swal(data.ListadoGrupoRubro[0].Codigox + ' ' + data.ListadoGrupoRubro[0].Mensajex, data.ListadoGrupoRubro[0].Titulox, data.ListadoGrupoRubro[0].Tipox);
                    } else {
                        $("#table-gruporubro").DataTable({
                            "destroy": true,
                            "paging": true,
                            "lengthChange": true,
                            "searching": true,
                            "ordering": true,
                            "info": true,
                            "autoWidth": true,
                            "responsive": true,
                            data: data.ListadoGrupoRubro,
                            columns: [
                                {
                                    "data": "GrupoRubro_Id", "render": function (data) {
                                        var pGrupoRubro = "'" + data + "'";
                                        return '<a href="#" onclick="GetGrupoRubroPorId(' + pGrupoRubro + ')" data-dismiss="modal">' + data + '</a>';
                                    }
                                },
                                {
                                    "data": "Descripcion"
                                }
                            ]
                        });
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //Selecciona los datos del grupo de rubro
        function GetGrupoRubroPorId(pGrupoRubro_Id) {
            var parametros = { "pGrupoRubro_Id": pGrupoRubro_Id };
             $.ajax({
                type: 'POST',
                url: '@Url.Action("GetGrupoRubroPorId", "Wrkf_GrupoRubro")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                 success: function (data) {
                     $("#cbogruporubro").val(data.GrupoRubro.GrupoRubro_Id);
                     $("#cbogruporubrodesc").val(data.GrupoRubro.Descripcion);
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                     if (jqXHR.status === 0) {
                         msg = 'Not connect.\n Verify Network.';
                         swal(msg, 'Error', 'error');
                     } else if (jqXHR.status == 404) {
                         msg = 'Requested page not found. [404]';
                         swal(msg, 'Error', 'error');
                     } else if (jqXHR.status == 500) {
                         msg = 'Internal Server Error [500].';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'parsererror') {
                         msg = 'Requested JSON parse failed.';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'timeout') {
                         msg = 'Time out error.';
                         swal(msg, 'Error', 'error');
                     } else if (exception === 'abort') {
                         msg = 'Ajax request aborted.';
                         swal(msg, 'Error', 'error');
                     } else {
                         msg = 'Uncaught Error.\n' + jqXHR.responseText;
                         swal(msg, 'Error', 'error');
                     }
                 }
             });
        }

        //Funcion listar la moneda de operacion
        function GetMoneda(curncyid) {

            var parametros = {};
            var total_elemento = 0;
            var detalles = "";

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetListarMonedas", "Wrkf_Moneda")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    var monedas = [];
                    monedas = data;
                    total_elemento = monedas.length;
                    detalles = '<option value="">--Seleccionar--</option>';
                    if (total_elemento > 0) {
                        for (x = 0; x < total_elemento; x++) {
                            if (curncyid == monedas[x].Curncyid)
                                detalles += '<option value="' + monedas[x].Curncyid + '" selected>' + monedas[x].Curncyid + " - " + monedas[x].Crncydsc + '</option>';
                            else
                                detalles += '<option value="' + monedas[x].Curncyid + '">' + monedas[x].Curncyid + " - " + monedas[x].Crncydsc + '</option>';
                        }
                        $("#cbomoneda").html(detalles);
                    }
                },
                error: function (ex) {
                    var r = jQuery.parseJSON(response.responseText);
                    alert("Message: " + r.Message);
                    alert("StackTrace: " + r.StackTrace);
                    alert("ExceptionType: " + r.ExceptionType);
                }
            });
        }

        //La funcion anula la solicitud de orden de pago seleccionada
        function AnularSolicitudOrdenPago(pCodigo) {
            var mensaje = "";

            if ($("#hddSolicitudOrdenPago_Id").val() == "-1") {
                swal("Debe seleccionar una solicitud para realizar la Anulación", "Información", "info");
            } else {
                mensaje = "La anulación sera aplicada a todos los pagos que esten asociados a la solicitud. ";
                mensaje += "Despues que la solicitud de la orden de pago sea anulada no permitira cambios en los datos ¿Desea Continuar...?";

                swal({
                    title: "Anular Solicitud Orden de Pago",
                    text: mensaje,
                    icon: "warning",
                    buttons: true,
                    successMode: true,
                })
                .then((willDelete) => {
                    if (willDelete) {
                        var parametros = { "pCodigo": pCodigo };
                            $.ajax({
                                type: 'POST',
                                url: '@Url.Action("AnularSolicitudOrdenPago", "Wrkf_SolicitudOrdenPago")',
                                content: "application/json; charset=utf-8",
                                dataType: 'json',
                                data: parametros,
                                success: function (data) {
                                    if (data.Codigox.length > 0) {
                                        swal(data.Codigox + " " + data.Mensajex, data.Titulox, data.Tipox);
                                    } else {
                                        swal("La solicitud de orden de pago fue anulada", "Información", "info");
                                        GetSolicitudOrdenPagoTodas();
                                    }
                                },
                                error: function (ex) {
                                    var r = jQuery.parseJSON(response.responseText);
                                    alert("Message: " + r.Message);
                                    alert("StackTrace: " + r.StackTrace);
                                    alert("ExceptionType: " + r.ExceptionType);
                                }
                            });
                    }
                });
            }
        }

        //Coloca en cero los campos calculados
        function ColocarCeroCamposCalculados() {
            $("#txtBaseIvaGE").val("0,00");
            $("#txtBaseIvaRe").val("0,00");
            $("#txttotal").val("0,00");
        }

        //descargar soporte de la solicitud
        function Descargarsoporte(url) {
            var urldescarga = url + '?pCodigo=' + $("#txtcodigoSolicitud").val();
            window.open(urldescarga, "_blank", "directories=no,location=no,menubar=no,status=no,titlebar=no,toolbar=no,scrollbars=yes,resizable=no,top=500,left=500,width=500,height=500");
        }

        //imprime un reporte de la solicitud enviada a CxP
        function ImprimirSolicitudOrdenPago(solicitudordenpago_id) {

            var screenWidth = screen.width;
            var screenHeight = screen.height;

            var url = '@Url.Action("ReporteSolicitudEnviadaCxP", "Wrkf_SolicitudOrdenPago")';
            url += '?Solicitudordenpago_Id=' + solicitudordenpago_id;

            window.open(url, '_blank', 'toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=' + screenWidth + ',height=' + screenHeight);
        }


    //Listar el Plan de Inpuesto del IVA para la Compra
        function ListarDetalleImpuestoIVACompra() {
            var parametros = { "TaxScheduleID": $("#txtTaxScheduleID").val() };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ListarDetalleImpuesto", "Tx00201")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    if (data[0].Codigox.length > 0) {
                        swal(data[0].Codigox + ' ' + data[0].Mensajex, data[0].Titulox, data[0].Tipox);
                    } else {
                        $("#table-plan-impuesto-iva").DataTable({
                            "destroy": true,
                            "paging": true,
                            "lengthChange": true,
                            "searching": true,
                            "ordering": true,
                            "info": true,
                            "autoWidth": true,
                            "responsive": true,
                            data: data,
                            columns: [
                                {
                                    "data": "Taxdtlid", "render": function (data) {
                                        return '<a href="#" onclick="SeleccionarImpuesto(' + data + ')" data-dismiss="modal">' + data + '</a>';
                                    }
                                },
                                {
                                    "data": "Txdtldsc", "render": function (data) {
                                        return '<div style="text-align:center;">' + data + '</div>';
                                    }
                                },
                                {
                                    "data": "Txdtlpct", "render": function (data) {
                                        return '<div style="text-align:center;">' + data + ' % </div>';
                                    }
                                }
                            ]
                        });
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        var vInputCodigoPlantilla = document.getElementById("txtCodigoPlantilla");
        // Execute a function when the user releases a key on the keyboard
        vInputCodigoPlantilla.addEventListener("keyup", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                SeleccionarPlantilla($("#txtCodigoPlantilla").val());
            }
        });

        var vInputMontoDocumento = document.getElementById("txtmontodocumento");
        // Execute a function when the user releases a key on the keyboard
        vInputMontoDocumento.addEventListener("keyup", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                GetCalcularMontos();
                document.getElementById("txtBaseIvaGE").focus();
            }
        });

        var vInputBaseIvaGE = document.getElementById("txtBaseIvaGE");
        // Execute a function when the user releases a key on the keyboard
        vInputBaseIvaGE.addEventListener("keyup", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                GetCalcularMontos();
                document.getElementById("txtBaseIvaRe").focus();
            }
        });

        var vInputBaseIvaRe = document.getElementById("txtBaseIvaRe");
        // Execute a function when the user releases a key on the keyboard
        vInputBaseIvaRe.addEventListener("keyup", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                GetCalcularMontos();
                document.getElementById("txtBaseIvaAd").focus();
            }
        });

        var vInputBaseIvaAd = document.getElementById("txtBaseIvaAd");
        // Execute a function when the user releases a key on the keyboard
        vInputBaseIvaAd.addEventListener("keyup", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                GetCalcularMontos();
            }
        });

        $("#txtmontodocumento").maskMoney({ thousands: '.', decimal: ',', allowZero: true });
        $("#txtBaseIvaGE").maskMoney({ thousands: '.', decimal: ',', allowZero: true });
        $("#txtBaseIvaRe").maskMoney({ thousands: '.', decimal: ',', allowZero: true });
        $("#txtBaseIvaAd").maskMoney({ thousands: '.', decimal: ',', allowZero: true });

    </script>
</body>
</html>