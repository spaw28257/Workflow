<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MENTEX C.A.</title>
    <!-- Google Font: Source Sans Pro -->
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

    <!-- Font Awesome -->
    <link href="~/Adminlte/plugins/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <!-- DataTables -->
    <link href="~/Adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css" rel="stylesheet" />
    <!-- Theme style -->
    <link href="~/Adminlte/css/adminlte.min.css" rel="stylesheet" />
    <link href="~/Adminlte/css/mentex.css" rel="stylesheet" />

    <!---mensajes sweetalert-->
    <script src="~/Adminlte/plugins/sweetalert2/sweetalert.min.js"></script>

</head>

<body class="hold-transition sidebar-mini layout-fixed" onload="GetPagosAprobacionCxP();">
    <div class="wrapper">

        <!-- Preloader -->
        <div class="preloader flex-column justify-content-center align-items-center">
            <img src="~/Adminlte/img/Iphone-spinner-2.gif" class="animation__shake brand-image img-rounded elevation-3"
                 alt="Mentex C.A." height="40" width="40" />
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                        <i class="fas fa-bars fas fa-"></i>
                    </a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="@Url.Action(" Index", "Home" )" class="nav-link">
                        <i class="fas fa-home"></i>&nbsp;Inicio
                    </a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" class="nav-link" data-toggle="modal" data-target="#modal-buscar-pagos">
                        <i class="fas fa-search"></i>&nbsp;Buscar Pagos
                    </a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="#" class="nav-link" onclick="AprobarRechazarPagos('masiva');">
                        <i class="fas fa-search"></i>&nbsp;Aprobar / Rechazar Pagos
                    </a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="@Url.Action(" CerrarSesion", "Wrkf_Login" )" class="nav-link">
                        <i class="fas fa-lock"></i>&nbsp;Cerrar Sesión
                    </a>
                </li>
            </ul>
        </nav>
        <!-- /.navbar -->
        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-light elevation-4">
            <!-- Brand Logo -->
            <a href="#" class="brand-link">
                <img src="~/Adminlte/img/LogoWorkflow.png" alt="AdminLTE Logo"
                     class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-light">MENTEX C.A.</span>
            </a>

            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Sidebar user panel (optional) -->
                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        <img src="~/Adminlte/img/user_undefine160x160.png" class="img-circle elevation-2"
                             alt="User Image" />
                    </div>
                    <div class="info">
                        <a href="#" class="d-block">@Session["sUsuario_Id"]</a>
                    </div>
                </div>

                <!-- Sidebar Menu -->
                <nav class="mt-2">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu"
                        data-accordion="false" id="ulOpcionesMenu">

                        @foreach (var listadomenu in ViewBag.listaropcionesmenu)
                        {
                            <li class="nav - item">
                                <p>
                                    <a href="@Url.Action(@listadomenu.Accionx, @listadomenu.Controladorx)">
                                        <i class="@listadomenu.Imagenx"></i>&nbsp;@listadomenu.Menux
                                    </a>
                                </p>
                            </li>
                        }

                    </ul>
                </nav>
                <!-- /.sidebar-menu -->
            </div>
            <!-- /.sidebar -->
        </aside>

        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <br />
            <!-- Main content -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header" style="background-color:#82293E;">
                                    <h3 class="card-title" style="color:#FFFFFF;">
                                        Solicitudes de Ordenes de Pago (Aprobación CXP)
                                    </h3>
                                </div>
                                <!-- /.card-header -->
                                <div class="card-body">

                                    <table id="table-pagos" class="table table-bordered table-hover"
                                           style="width:100%;">
                                        <thead>
                                            <tr class="cabecera-tabla">
                                                <th style="text-align:center; font-weight:bold;">
                                                    Aprobar
                                                </th>
                                                <th style="text-align:center; font-weight:bold;">
                                                    Rechazar
                                                </th>
                                                <th style="text-align:center; font-weight:bold;">
                                                    Soportes
                                                </th>
                                                <th style="text-align:center; font-weight:bold;">N° Pago</th>
                                                <th style="text-align:center; font-weight:bold;">Código Plantilla</th>
                                                <th style="text-align:center; font-weight:bold;">Beneficiario</th>
                                                <th style="text-align:center; font-weight:bold;">N° Factura</th>
                                                <th style="text-align:center; font-weight:bold;">Monto</th>
                                                <th style="text-align:center; font-weight:bold;">Código Moneda</th>
                                                <th style="text-align:center; font-weight:bold;">Fecha Factura</th>
                                                <th style="text-align:center; font-weight:bold;">Fecha Pago</th>
                                                <th style="text-align:center; font-weight:bold;">Id Chequera</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="12">&nbsp;</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <!-- /.card-body -->
                            </div>
                            <!-- /.card -->
                        </div>
                        <!-- /.col -->
                    </div>
                </div><!-- /.container-fluid -->
            </section>
            <!-- /.content -->
        </div>

        <!-- /.modal -->
        <!--Mostar las observaciones de la solicitud del pago-->
        <div class="modal fade" id="modal-xl1">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Observaciones de la Solicitud de Pago</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header cabecera-tabla">
                                            <h3 class="card-title" id="txtnumobssolicitud">&nbsp;</h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <p class="justificar-parrafo" id="txtobservacionessoli"></p>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <!--Ver el detalle de la solicitud del pago que esta aprobando o rechazando-->
        <div class="modal fade" id="modal-detalle-pago">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Detalle de la Solicitud de Pago</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header cabecera-tabla">
                                            <h3 class="card-title" id="TituloSolicitud">
                                                Datos de la Solicitud de Orden de Pago
                                            </h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Código Pago:</label>
                                                    <input type="text" name="Codigo" id="Codigo" class="form-control"
                                                           style="background-color: oldlace;" readonly />
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Item Pago:</label>
                                                    <input type="text" name="GAPCodigoItem" id="GAPCodigoItem"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Id Proveedor:</label>
                                                    <input type="text" name="GAPIdProveedor" id="GAPIdProveedor"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Proveedor:</label>
                                                    <input type="text" name="GAPProveedor" id="GAPProveedor"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <label>Código Plantilla:</label>
                                                    <input type="text" name="GAPCodigoPlantilla" id="GAPCodigoPlantilla"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-6">
                                                    <label>Plantilla:</label>
                                                    <input type="text" name="GAPDescripcionPlantilla"
                                                           id="GAPDescripcionPlantilla" class="form-control"
                                                           style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-3">
                                                    <label>N° Factura:</label>
                                                    <input type="text" name="GAPNroFactura" id="GAPNroFactura"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>N° Control:</label>
                                                    <input type="text" name="GAPNroControl" id="GAPNroControl"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Fecha Factura:</label>
                                                    <input type="text" name="GAPFechaFactura" id="GAPFechaFactura"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-3">
                                                    <label>Fecha Pago:</label>
                                                    <input type="text" name="GAPFechaPago" id="GAPFechaPago"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <label>Id Chequera:</label>
                                                    <input type="text" name="GAPIdChequera" id="GAPIdChequera"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-4">
                                                    <label>Código Moneda:</label>
                                                    <input type="text" name="CodigoMoneda" id="CodigoMoneda"
                                                           class="form-control" style="background-color: oldlace;"
                                                           readonly />
                                                </div>
                                                <div class="col-md-4">
                                                    <label>Monto:</label>
                                                    <input type="text" name="GAPMonto" id="GAPMonto"
                                                           class="form-control text-right"
                                                           style="background-color: oldlace;" readonly />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>Descripción Factura:</label>
                                                    <input type="text" name="GAPDescripcionFactura"
                                                           id="GAPDescripcionFactura" class="form-control" readonly
                                                           style="text-align: left; background-color: oldlace;" />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-4">
                                                    <label>Usuario Revisión:</label>
                                                    <input type="text" name="UsuarioRevisionCxP"
                                                           id="UsuarioRevisionCxP" class="form-control" readonly
                                                           style="text-align: left; background-color: oldlace;" />
                                                </div>
                                                <div class="col-md-4">
                                                    <label>Fecha Revisión:</label>
                                                    <input type="text" name="FechaRevisionCxP"
                                                           id="FechaRevisionCxP" class="form-control" readonly
                                                           style="text-align: left; background-color: oldlace;" />
                                                </div>
                                                <div class="col-md-4">
                                                    <label>Observaciones de la Revisión:</label>
                                                    <textarea id="ObservacionRevisionCxP" name="ObservacionRevisionCxP"
                                                              rows="1" cols="80" class="form-control" style="text-align: left; background-color: oldlace;" readonly></textarea>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    &nbsp;
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <label>
                                                        ¿Documentos de Soportes Recibidos?
                                                    </label>
                                                    <input type="checkbox" name="chkDocumentoSoportesdet"
                                                           id="chkDocumentoSoportesdet" />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    &nbsp;
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-6 text-center">
                                                    <label>
                                                        Aprobar Solicitud de Pago
                                                    </label>
                                                    <input type="checkbox" name="chkaprobardet" id="chkaprobardet" />
                                                </div>
                                                <div class="col-md-6 text-center">
                                                    <label>
                                                        Rechazar Solicitud de Pago
                                                    </label>
                                                    <input type="checkbox" name="chkrechazardet" id="chkrechazardet" />
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    <label>
                                                        Observaciones de la Aprobación
                                                    </label>
                                                    <textarea id="ObservacionCxP" name="ObservacionCxP"
                                                              rows="2" cols="80" class="form-control" style="text-align: left; background-color: oldlace;"></textarea>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12">
                                                    &nbsp;
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-md-12 text-center">
                                                    <button type="button" class="btn btn-default" id="btnAplicarCambios"
                                                            onclick="AprobarRechazarPagos('detalle')">
                                                        Aprobar / Rechazar
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

        <!-- /.modal -->
        <!--Filtrar por rango de fecha pago-->
        <div class="modal fade" id="modal-buscar-pagos">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Filtrar Por Fecha de Pago</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header cabecera-tabla">
                                            <h3 class="card-title" id="txtnumobssolicitud">
                                                Seleccione el rango de fecha
                                            </h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <form name="frmpagoscxp" id="frmpagoscxp">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group">
                                                                    <label for="txtfechadesde">
                                                                        Fecha de Pago
                                                                        Desde
                                                                    </label>
                                                                    <input type="date" class="form-control"
                                                                           name="txtfechadesde" id="txtfechadesde"
                                                                           style="background-color: oldlace;"
                                                                           value="@ViewBag.FechaPagoDesde" />
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-group">
                                                                    <label for="txtfechahasta">
                                                                        Fecha de Pago
                                                                        Hasta
                                                                    </label>
                                                                    <input type="date" class="form-control"
                                                                           name="txtfechahasta" id="txtfechahasta"
                                                                           style="background-color: oldlace;"
                                                                           value="@ViewBag.FechaPagoHasta" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="row">
                                                            <div class="col-md-12 alinear-centro">
                                                                <input type="button" name="btnvolveramostrar"
                                                                       id="btnvolveramostrar" value="Mostrar Pagos"
                                                                       class="btn btn-default"
                                                                       onclick="GetPagosAprobacionCxP()"  data-dismiss="modal"/>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->
        <div class="modal fade" id="modal-rechazosubcontra">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Motivo de Rechazo Por SubContraloria</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header cabecera-tabla">
                                            <h3 class="card-title" id="txtnumobssolicitudrechazosubcontra">&nbsp;</h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <p class="justificar-parrafo" id="txtobssolicitudrechazosubcontra"></p>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>

        <!-- /.modal -->
        <div class="modal fade" id="modal-documento-soporte">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Documentos de Soportes</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header cabecera-tabla">
                                            <h3 class="card-title" id="">&nbsp;</h3>
                                        </div>
                                        <!-- /.card-header -->
                                        <div class="card-body">
                                            <table class="table table-bordered table-hover" style="width:100%;">
                                                <thead>
                                                    <tr class="cabecera-tabla">
                                                        <th>Soportes Pago</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="DetalleSoporte"></tbody>
                                            </table>
                                        </div>
                                        <!-- /.card-body -->
                                    </div>
                                    <!-- /.card -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->

        <footer class="main-footer">
            @*<strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong>All rights
                reserved.*@
            <div class="float-right d-none d-sm-inline-block">
                <b>WorkFlow Cuentas Por Pagar Version</b> 1.0
            </div>
        </footer>

        <!-- Control Sidebar -->
        <aside class="control-sidebar control-sidebar-dark">
            <!-- Control sidebar content goes here -->
        </aside>
        <!-- /.control-sidebar -->
    </div>
    <!-- ./wrapper -->
    <!-- jQuery -->
    <script src="~/Adminlte/plugins/jquery/jquery.min.js"></script>
    <!-- Bootstrap 4 -->
    <script src="~/Adminlte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- DataTables  & Plugins -->
    <script src="~/Adminlte/plugins/datatables/jquery.dataTables.js"></script>
    <script src="~/Adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>

    <!-- AdminLTE App -->
    <script src="~/Adminlte/js/adminlte.min.js"></script>
    <!-- AdminLTE for demo purposes -->
    <script src="~/Adminlte/js/demo.js"></script>
    <script src="~/Scripts/UtilidadesVarias.js"></script>

    <script>

        //Obtiene una lista de los pagos que debe revisar el analista de cuentas por pagar
        function GetPagosAprobacionCxP() {

            var parametros = {
                "pFechaPagoDesde": $("#txtfechadesde").val(),
                "pFechaPagoHasta": $("#txtfechahasta").val()
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetPagosAprobacionCxP", "Wrkf_SolicitudOrdenPagoCxP")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {

                    if (data.ListadoPago[0].Mensajex.length > 0) {
                        swal(data.ListadoPago[0].Codigox + ' ' + data.ListadoPago[0].Mensajex, data.ListadoPago[0].Titulox, data.ListadoPago[0].Tipox);
                    } else {
                        $("#table-pagos").DataTable({
                            "destroy": true,
                            "paging": true,
                            "lengthChange": true,
                            "searching": true,
                            "ordering": true,
                            "info": true,
                            "autoWidth": true,
                            "responsive": true,
                            data: data.ListadoPago,
                            columns: [
                                {
                                    "data": "Codigo", "render": function (data) {
                                        var pCodigoPago = data;
                                        var strHtml = '<div class="row">';
                                        strHtml += '<div class="col-md-12 text-center">';
                                        strHtml += '<input type="checkbox" name="chkaprobar" id="chkaprobar" value="' + pCodigoPago + '" />';
                                        strHtml += '</div>';
                                        strHtml += '</div>';
                                        return strHtml;
                                    }
                                },
                                {
                                    "data": "Codigo", "render": function (data) {
                                        var pCodigoPago = data;
                                        var strHtml = '<div class="row">';
                                        strHtml += '<div class="col-md-12 text-center">';
                                        strHtml += '<input type="checkbox" name="chkrechazar" id="chkrechazar" value="' + pCodigoPago + '" />';
                                        strHtml += '</div>';
                                        strHtml += '</div>';
                                        return strHtml;
                                    }
                                },
                                {
                                    "data": "Codigo", "render": function (data) {
                                        var pCodigoPago = data;
                                        var strHtml = '<div class="row">';
                                        strHtml += '<div class="col-md-12 text-center">';
                                        strHtml += '<input type="checkbox" name="chkDocumentoSoportes" id="chkDocumentoSoportes" value="' + pCodigoPago + '" />';
                                        strHtml += '</div>';
                                        strHtml += '</div>';
                                        return strHtml;
                                    }
                                },
                                {
                                    "data": "Codigo", "render": function (data) {
                                        var pCodigoPago = data;
                                        var strHtml = '<a href="#"  data-toggle="modal" data-target="#modal-detalle-pago" ';
                                        strHtml += 'style = "cursor:pointer" title = "Detalle del Pago" onclick="GetDetallePago(' + pCodigoPago + ')"> <u>' + data + '</u></a > ';
                                        return strHtml;
                                    }
                                },
                                {
                                    "data": "GAPCodigoPlantilla"
                                },
                                {
                                    "data": "GAPProveedor"
                                },
                                {
                                    "data": "GAPNroFactura"
                                },
                                {
                                    "data": "GAPMonto", "render": function (data) {
                                        return number_format(parseFloat(data), 2, ',', '.');
                                    }
                                },
                                {
                                    "data": "CodigoMoneda"
                                },
                                {
                                    "data": "GAPFechaFactura", "render": function (data) {
                                        return data.substring(0, 10);
                                    }
                                },
                                {
                                    "data": "GAPFechaPago", "render": function (data) {
                                        return data.substring(0, 10);
                                    }
                                },
                                {
                                    "data": "GAPIdChequera"
                                }
                            ]
                        });
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //seleccionar el detalle del pago por el código de pago
        function GetDetallePago(pCodigoPago) {
            var parametros = {
                "pCodigo": pCodigoPago
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetDetalleOrdenPagoPorRevisarCxP", "Wrkf_SolicitudOrdenPagoCxP")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {

                    var arrDetallePago = [];
                    arrDetallePago = data.DetallePago;

                    if (arrDetallePago.Codigox.length > 0) {
                        swal(arrDetallePago.Codigox + ' ' + arrDetallePago.Mensajex, arrDetallePago.Titulox, arrDetallePago.Tipox);
                    } else {
                        //Titulo del Detalle
                        $("#TituloSolicitud").html("");
                        $("#TituloSolicitud").html("Datos de la Solicitud de Orden de Pago: " + arrDetallePago.Codigo);
                        $("#Codigo").val(arrDetallePago.Codigo);
                        $("#GAPCodigoItem").val(arrDetallePago.GAPCodigoItem);

                        //Datos del proveedor
                        $("#GAPIdProveedor").val(arrDetallePago.GAPIdProveedor);
                        $("#GAPProveedor").val(arrDetallePago.GAPProveedor);

                        //Datos de la plantilla
                        $("#GAPCodigoPlantilla").val(arrDetallePago.GAPCodigoPlantilla);
                        $("#GAPDescripcionPlantilla").val(arrDetallePago.GAPDescripcionPlantilla);

                        //Datos de la Factura
                        $("#GAPNroFactura").val(arrDetallePago.GAPNroFactura);
                        $("#GAPNroControl").val(arrDetallePago.GAPNroControl);
                        $("#GAPFechaFactura").val(arrDetallePago.GAPFechaFactura.substring(0, 10));
                        $("#GAPFechaPago").val(arrDetallePago.GAPFechaPago.substring(0, 10));
                        $("#GAPIdChequera").val(arrDetallePago.GAPIdChequera);
                        $("#CodigoMoneda").val(arrDetallePago.CodigoMoneda);
                        var vMonto = number_format(parseFloat(arrDetallePago.GAPMonto), 2, ',', '.');
                        $("#GAPMonto").val(vMonto);
                        $("#GAPDescripcionFactura").val(arrDetallePago.GAPDescripcionFactura);

                        //Grupo Rubro y Rubro
                        $("#GrupoRubro_Id").val(arrDetallePago.GrupoRubro_Id);
                        $("#GrupoRubroDescripcion").val(arrDetallePago.GrupoRubroDescripcion);
                        $("#Rubro_Id").val(arrDetallePago.Rubro_Id);
                        $("#RubroDescripcion").val(arrDetallePago.RubroDescripcion);

                        $("#UsuarioRevisionCxP").val(arrDetallePago.UsuarioRevisionCxP);
                        document.getElementById('FechaRevisionCxP').value = arrDetallePago.FechaRevisionCxP;
                        $("#ObservacionRevisionCxP").val(arrDetallePago.ObservacionRevisionCxP);

                        $("#chkaprobardet").prop("checked", false);
                        $("#chkaprobardet").prop("value", pCodigoPago);

                        $("#chkrechazardet").prop("checked", false);
                        $("#chkrechazardet").prop("value", pCodigoPago);
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //Aplicar cambios en el pago
        function ActualizarGrupoRubro() {

            var chkDocumentoSoportes = document.getElementsByName("chkDocumentoSoportes");
            var soportes;

            if (chkDocumentoSoportes[0].checked) {
                soportes = true;
            }
            else {
                soportes = false;
            }

            var parametros = {
                "pcodigo": $("#Codigo").val(),
                "pgruporubro_id": $("#GrupoRubro_Id").val(),
                "prubro_id": $("#Rubro_Id").val(),
                "psoportesfacturas": soportes,
                "pobservacion": $("#ObservacionRevision").val()
            };

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ActualizarGrupoRubro", "Wrkf_SolicitudOrdenPagoCxP")',
                content: "application/json; charset=utf-8",
                dataType: 'json',
                data: parametros,
                success: function (data) {
                    if (data.RespuestaOperacion.Codigox.length > 0) {
                        swal(data.RespuestaOperacion.Codigox + ' ' + data.RespuestaOperacion.Mensajex, data.RespuestaOperacion.Titulox, data.RespuestaOperacion.Tipox);
                    }
                    else {
                        swal('La revisión del pago fue realizada', 'Actualizar datos del pago', 'success');
                        GetPagosRevisionCxP();
                        $("#modal-detalle-pago").modal("hide");
                    }
                },
                error: function (jqXHR, exception) {
                    var msg = '';
                    if (jqXHR.status === 0) {
                        msg = 'Not connect.\n Verify Network.';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 404) {
                        msg = 'Requested page not found. [404]';
                        swal(msg, 'Error', 'error');
                    } else if (jqXHR.status == 500) {
                        msg = 'Internal Server Error [500].';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'parsererror') {
                        msg = 'Requested JSON parse failed.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'timeout') {
                        msg = 'Time out error.';
                        swal(msg, 'Error', 'error');
                    } else if (exception === 'abort') {
                        msg = 'Ajax request aborted.';
                        swal(msg, 'Error', 'error');
                    } else {
                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        swal(msg, 'Error', 'error');
                    }
                }
            });
        }

        //funcion para marcar o rechazar los pagos por CXP
        function AprobarRechazarPagos(popcion) {
            var vListadoaprobacion = "";
            var vListadorechazo = "";
            var vListadosoporte = "";
            var vContadoraprobadas = 0;
            var vContadorrechazadas = 0;
            var vContadorsoportes = 0;
            var vNombreControlApr = "";
            var vNombreControlRec = "";
            var vNombreControlSop = "";

            if (popcion == "detalle") {
                vNombreControlApr = "chkaprobardet";
                vNombreControlRec = "chkrechazardet";
                vNombreControlSop = "chkDocumentoSoportesdet";
            } else {
                vNombreControlApr = "chkaprobar";
                vNombreControlRec = "chkrechazar";
                vNombreControlSop = "chkDocumentoSoportes";
            }

            var chkaprobado = document.getElementsByName(vNombreControlApr);
            var chkrechazado = document.getElementsByName(vNombreControlRec);
            var chksoporte = document.getElementsByName(vNombreControlSop);
            var vObservacionesCxP = $("#ObservacionCxP").val();

            //verificar que no exista el checkbox de aprobacion y rechazo activo para la misma solicitud
            for (x = 0; x < chkaprobado.length; x++) {
                if ((chkaprobado[x].checked) && (chkrechazado[x].checked)) {
                    swal("Una solicitud no puede ser aprobada y rechazada al mismo tiempo seleccione la casilla de aprobación o rechazo", "Aprobación o Rechazo Por Contraloria", "error");
                    chkaprobado[x].checked = false;
                    chkrechazado[x].checked = false;
                }
            }

            //verifica las solicitudes que fueron aprobadas
            for (x = 0; x < chkaprobado.length; x++) {
                if (chkaprobado[x].checked) {
                    vListadoaprobacion += chkaprobado[x].value + ";";
                    //contar el total de solicitudes aprobadas
                    vContadoraprobadas = parseInt(vContadoraprobadas) + 1;
                }
            }

            //verifica las solicitudes que fueron marcadas para ser rechazadas
            for (x = 0; x < chkrechazado.length; x++) {
                if (chkrechazado[x].checked) {
                    vListadorechazo += chkrechazado[x].value + ";";
                    vContadorrechazadas = parseInt(vContadorrechazadas) + 1;
                }
            }

            //verifica las solicitudes que fueron marcadas que tiene soportes de los pagos
            for (x = 0; x < chksoporte.length; x++) {
                if (chksoporte[x].checked) {
                    vListadosoporte += chksoporte[x].value + ";";
                    vContadorsoportes = parseInt(vContadorsoportes) + 1;
                }
            }

            //si existe algun pago marcado se realiza el proceso de aprobación o rechazo
            if ((vContadoraprobadas > 0) || (vContadorrechazadas > 0)) {

                var vTotalsolicitudes = parseInt(vContadoraprobadas) + parseInt(vContadorrechazadas);
                var vMensaje = "La cantidad de solicitudes de pago que desea procesar es: ";
                vMensaje = vMensaje + vTotalsolicitudes + " de las cuales fueron aprobada (s) " + vContadoraprobadas + "  y Rechazada (s) " + vContadorrechazadas;
                vMensaje = vMensaje + " ¿Desea continuar realizando el proceso de la (s) solicitud (es)?";

                swal({
                    title: "Aprobación Y Rechazo de Solicitudes Por CxP",
                    text: vMensaje,
                    icon: "warning",
                    buttons: true,
                    successMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {

                            if (vObservacionesCxP === '') {
                                vObservacionesCxP = 'Solicitudes de pagos aprobadas o rechazadas de forma masiva.';
                            }

                            var parametros = {
                                "plistapagosaprobados": vListadoaprobacion,
                                "plistapagosrechazados": vListadorechazo,
                                "plistadopagossoportes": vListadosoporte,
                                "pobservacion": vObservacionesCxP
                            };

                            $.ajax({
                                type: 'POST',
                                url: '@Url.Action("AprobarRechazarPagosCxP", "Wrkf_SolicitudOrdenPagoCxP")',
                                content: "application/json; charset=utf-8",
                                dataType: 'json',
                                data: parametros,
                                success: function (data) {
                                    if (data.RespuestaOperacion.Codigox.length > 0) {
                                        swal(data.RespuestaOperacion.Codigox + " " + data.RespuestaOperacion.Mensajex, data.RespuestaOperacion.Titulox, data.RespuestaOperacion.Tipox);
                                    } else {
                                        swal("La solicitud de pago fueron procesadas con éxito", "Información", "info");
                                        setInterval("location.reload()", 2000);
                                    }
                                },
                                error: function (jqXHR, exception) {
                                    var msg = '';
                                    if (jqXHR.status === 0) {
                                        msg = 'Not connect.\n Verify Network.';
                                        swal(msg, 'Error', 'error');
                                    } else if (jqXHR.status == 404) {
                                        msg = 'Requested page not found. [404]';
                                        swal(msg, 'Error', 'error');
                                    } else if (jqXHR.status == 500) {
                                        msg = 'Internal Server Error [500].';
                                        swal(msg, 'Error', 'error');
                                    } else if (exception === 'parsererror') {
                                        msg = 'Requested JSON parse failed.';
                                        swal(msg, 'Error', 'error');
                                    } else if (exception === 'timeout') {
                                        msg = 'Time out error.';
                                        swal(msg, 'Error', 'error');
                                    } else if (exception === 'abort') {
                                        msg = 'Ajax request aborted.';
                                        swal(msg, 'Error', 'error');
                                    } else {
                                        msg = 'Uncaught Error.\n' + jqXHR.responseText;
                                        swal(msg, 'Error', 'error');
                                    }
                                }
                            });
                        }
                    })
            } else {
                swal("Debe seleccionar los pagos que desea aprobar o rechazar", "Error", "error");
            }
        }
    </script>
</body>

</html>